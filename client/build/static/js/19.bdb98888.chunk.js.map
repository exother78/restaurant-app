{"version":3,"sources":["Components/DevAdmin/Categories/CreateCategory.jsx"],"names":["GetCategories","lazy","CreateCategory","useStateValue","categoriesAPI","userAPI","token","categories","callback","setCallback","isAdmin","useState","name","images","categoryForm","setCategoryForm","fileImage","setFileImage","imageUpload","setImageUpload","loading","setLoading","createCategoryLoading","setCreateCategoryLoading","onEdit","setOnEdit","catid","setCatid","error","setError","success","setSuccess","upload","a","axios","post","headers","Authorization","res","console","log","response","data","categoryUpload","d","public_id","url","handleSubmit","e","preventDefault","then","message","err","setTimeout","deleteCategoryImage","pub_id","clearAll","handleEditSubmit","categoryUpdate","y","patch","handleDelete","category","deleteCategory","delete","_id","className","onSubmit","style","letterSpacing","padding","userSelect","type","onChange","getFile","target","files","alert","formData","FormData","append","reader","FileReader","readAsDataURL","onloadend","result","src","alt","onClick","placeholder","required","value","prevValues","fallback","handleEdit"],"mappings":"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","file":"static/js/19.bdb98888.chunk.js","sourcesContent":["import axios from \"axios\";\nimport React, { useState, lazy, Suspense } from \"react\";\nimport \"./CreateCategory.css\";\nimport { useStateValue } from \"../../../StateProvider\";\nimport Loading from \"../../Screens/Global/Loading\";\nconst GetCategories = lazy(() => import(\"./GetCategories/GetCategories\"));\n\nconst CreateCategory = () => {\n  const { categoriesAPI, userAPI, token } = useStateValue();\n  const [categories] = categoriesAPI.categories;\n  const [callback, setCallback] = categoriesAPI.callback;\n  const [isAdmin] = userAPI.isAdmin;\n\n  const [categoryForm, setCategoryForm] = useState({\n    name: \"\",\n    images: \"\",\n  });\n\n  const [fileImage, setFileImage] = useState(null);\n  const [imageUpload, setImageUpload] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [createCategoryLoading, setCreateCategoryLoading] = useState(false);\n  const [onEdit, setOnEdit] = useState(false);\n  const [catid, setCatid] = useState(\"\");\n  const [error, setError] = useState(null);\n  const [success, setSuccess] = useState(null);\n\n  const handleFileChange = (e) => {\n    const getFile = e.target.files[0];\n    if (!getFile) return alert(\"File Doesn't exist\");\n\n    let formData = new FormData();\n    formData.append(\"file\", getFile);\n    setImageUpload(formData);\n\n    const reader = new FileReader();\n\n    reader.readAsDataURL(getFile);\n    reader.onloadend = () => {\n      setFileImage(reader.result);\n    };\n  };\n\n  const upload = async () => {\n    try {\n      if (isAdmin) {\n        const res = await axios.post(\"/api/upload\", imageUpload, {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\",\n            Authorization: `Bearer ${token[0]}`,\n          },\n        });\n\n        return res;\n      }\n    } catch (error) {\n      console.log(error.response.data.error);\n    }\n  };\n\n  const categoryUpload = async (d) => {\n    try {\n      if (d) {\n        const res = await axios.post(\n          \"/api/category\",\n          {\n            ...categoryForm,\n            images: { public_id: d.data.public_id, url: d.data.url },\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${token[0]}`,\n            },\n          }\n        );\n\n        return res;\n      }\n\n      if (!d) {\n        const res = await axios.post(\n          \"/api/category\",\n          {\n            ...categoryForm,\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${token[0]}`,\n            },\n          }\n        );\n\n        return res;\n      }\n    } catch (err) {\n      setError(err.response.data.error);\n      return;\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setCreateCategoryLoading(true);\n\n    try {\n      if (fileImage) {\n        upload()\n          .then(categoryUpload)\n          .then((response) => {\n            setCallback(!callback);\n            setCreateCategoryLoading(false);\n            setCategoryForm({\n              name: \"\",\n              images: \"\",\n            });\n            setFileImage(null);\n            setImageUpload(null);\n            setSuccess(response.data.message);\n          });\n      }\n      if (!fileImage) {\n        categoryUpload().then((response) => {\n          setCallback(!callback);\n          setCreateCategoryLoading(false);\n          setCategoryForm({\n            name: \"\",\n            images: \"\",\n          });\n          setFileImage(null);\n          setImageUpload(null);\n          setSuccess(response.data.message);\n        });\n      }\n    } catch (err) {\n      setError(err.response.data.error);\n    }\n  };\n\n  if (success || error) {\n    setTimeout(() => {\n      setSuccess(null);\n      setError(null);\n    }, 2000);\n  }\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    setCategoryForm((prevValues) => ({\n      ...prevValues,\n      [name]: value,\n    }));\n  };\n\n  const clearImage = () => {\n    setImageUpload(null);\n    setFileImage(null);\n  };\n\n  const deleteCategoryImage = async (pub_id) => {\n    try {\n      if (pub_id) {\n        await axios.post(\n          \"/api/destroy\",\n          {\n            public_id: pub_id,\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${token[0]}`,\n            },\n          }\n        );\n      }\n\n      if (!pub_id) {\n        await axios.post(\n          \"/api/destroy\",\n          {\n            public_id: categoryForm.images.public_id,\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${token[0]}`,\n            },\n          }\n        );\n      }\n      // console.log(\"delete Image ran: and data \", res);\n    } catch (err) {\n      console.log(\"delete category image error: \", err.response.data);\n    }\n  };\n\n  const clearAll = () => {\n    setOnEdit(false);\n    setCreateCategoryLoading(false);\n    setCallback(!callback);\n    setFileImage(null);\n    setImageUpload(null);\n    setCategoryForm({ images: \"\", name: \"\" });\n  };\n\n  const handleEditSubmit = async (e) => {\n    e.preventDefault();\n    setCreateCategoryLoading(true);\n\n    const categoryUpdate = async (y) => {\n      try {\n        if (y) {\n          await axios.patch(\n            `/api/category/${catid}`,\n            {\n              name: categoryForm.name,\n              images: { public_id: y.data.public_id, url: y.data.url },\n            },\n            {\n              headers: {\n                Authorization: `Bearer ${token[0]}`,\n              },\n            }\n          );\n          clearAll();\n          return;\n        }\n        if (!y) {\n          await axios.patch(\n            `/api/category/${catid}`,\n            {\n              name: categoryForm.name,\n              images: categoryForm.images,\n            },\n            {\n              headers: {\n                Authorization: `Bearer ${token[0]}`,\n              },\n            }\n          );\n          clearAll();\n          return;\n        }\n      } catch (err) {\n        console.log(\"categoryUpdate error: \");\n        return;\n      }\n    };\n\n    if (imageUpload) {\n      deleteCategoryImage().then(upload).then(categoryUpdate);\n    }\n    if (!imageUpload) {\n      categoryUpdate();\n    }\n  };\n\n  const handleEdit = (category) => {\n    setOnEdit(true);\n    setCategoryForm({\n      ...categoryForm,\n      images: category.images,\n      name: category.name,\n    });\n    setFileImage(category.images.url);\n    setCatid(category._id);\n  };\n\n  const handleDelete = async (category) => {\n    setLoading(true);\n\n    const deleteCategory = async () => {\n      const res = await axios.delete(`/api/category/${category._id}`, {\n        headers: {\n          Authorization: `Bearer ${token[0]}`,\n        },\n      });\n\n      return res;\n    };\n\n    deleteCategoryImage(category.images.public_id)\n      .then(deleteCategory)\n      .then((response) => {\n        setCallback(!callback);\n        setLoading(false);\n        setSuccess(response.data.message);\n        return;\n      });\n  };\n\n  if (!categories) return <Loading />;\n  // if (categories) {\n  return (\n    <div className=\"categories__screen\">\n      {error && <div className=\"error__box\">{error}</div>}\n      {success && <div className=\"success__box\">{success}</div>}\n\n      {createCategoryLoading ? (\n        <Loading />\n      ) : (\n        <div className=\"create__category\">\n          <form onSubmit={onEdit ? handleEditSubmit : handleSubmit}>\n            <div className=\"category__img\">\n              <h3\n                style={{\n                  letterSpacing: \"1.3px\",\n                  padding: \"10px 20px\",\n                  userSelect: \"none\",\n                }}>\n                Add a Category\n              </h3>\n              {!fileImage && (\n                <input\n                  type=\"file\"\n                  className=\"category__img-input\"\n                  onChange={handleFileChange}\n                />\n              )}\n              {fileImage && (\n                <img style={{ userSelect: \"none\" }} src={fileImage} alt=\"\" />\n              )}\n              {fileImage && (\n                <span className=\"category__form-clear-img\" onClick={clearImage}>\n                  Clear Image\n                </span>\n              )}\n            </div>\n\n            <div className=\"category__input-group\">\n              <input\n                type=\"text\"\n                name=\"name\"\n                placeholder=\"Name *\"\n                required\n                className=\"category__input create__category-input-here\"\n                value={categoryForm.name}\n                onChange={handleInputChange}\n              />\n            </div>\n\n            {onEdit ? (\n              <button className=\"category__submit-button\" type=\"submit\">\n                Update\n              </button>\n            ) : (\n              <button className=\"category__submit-button\" type=\"submit\">\n                Submit\n              </button>\n            )}\n          </form>\n        </div>\n      )}\n\n      {loading ? (\n        <Loading />\n      ) : (\n        <Suspense fallback={<Loading />}>\n          <GetCategories\n            categories={categories}\n            handleDelete={handleDelete}\n            handleEdit={handleEdit}\n          />\n        </Suspense>\n      )}\n    </div>\n  );\n  // }\n};\n\nexport default CreateCategory;\n"],"sourceRoot":""}